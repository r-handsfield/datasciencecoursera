---
title: "c9w1l2 rCharts"
author: "Robert Handsfield"
date: "11/23/2015"
output: html_document
---

```{r echo=FALSE, eval=FALSE}
section for html scripts
```

```{r echo=FALSE, eval=FALSE}
end section for html scripts
```


```{r echo=FALSE, results='hide', warning=FALSE}

if (!"rCharts" %in% installed.packages()[,'Package']) { install.packages("rCharts") }
if (!"rCharts" %in% library()['Package']) { library("rCharts") }
```

# rCharts

rCharts is a package that uses javascript to create interactive visualizations for R. It (kind of) emulates the javascript D3 library.

For more info, see 

* [http://ramnathv.github.io/rCharts/]("http://ramnathv.github.io/rCharts/")
* [https://github.com/ramnathv/rCharts]("https://github.com/ramnathv/rCharts")

Install rCharts with the following:
```{r eval=FALSE}
require(devtools)
install_github(repo = 'rCharts', username = 'ramnathv')
```

Much of the interactivity is baked in by default via the various d3js libraries called by rCharts.



<font color="red">*Note: rChart plots render differently in knitr vs console. See</font>  [StackOverflow.]("http://stackoverflow.com/questions/17168464/2-knitr-r-markdown-rstudio-issues-highcharts-and-morris-js")

For knitr:  

* plot with `myPlot$print(title = 'title', include_assets=TRUE)`
* r chunk options must include `results='asis'`
* print the raw html with option `results='markup'`

---

For console:

* plot by calling the variable: `myPlot;`
* or by calling the plotting function: `rPlot(...);`

---

For RPubs:

* Use knitr with listed options
* use `myPlot$print(title = 'title', include_assets=TRUE, cdn=TRUE)`
	+ `cdn=TRUE` instructs document to server JS+CSS from RPubs rather than your local directory asset library

---

### Example 1: MorrisJS Plotting Library

In this example, `reshape2::transform()` is loaded automatically by `rCharts`.  
```{r, results='asis'}
require(rCharts)

data(economics, package = "ggplot2")
econ <- transform(economics, date = as.character(date))
m1 <- mPlot(x = "date", y = c("psavert", "uempmed"), type = "Line", data = econ)
m1$set(pointSize = 0, lineWidth = 1)
m1$print("chart2", include_assets=TRUE)

```

Per [http://ramnathv.github.io/rCharts/]("http://ramnathv.github.io/rCharts/"), rCharts has the following default libraries, invoked by the corresponding rChart functions.  
*Note: It appears that only Polychart and MorrisJS work out-of-the-box with rChart. The remainder need some additional libraries or configuration.

* Polychart:	`rPlot()` 
	+ _Grammer of Graphics_ syntax style, similar to __ggPlot2__
	+ [https://github.com/Polychart/polychart2]("https://github.com/Polychart/polychart2")
	+ ![polychart.png](./images/polychart.png)

```{r, echo=FALSE, eval=FALSE, results='asis'}
require(rCharts)

r1 <- rPlot(mpg ~ wt | am + vs, data = mtcars, type = "point", color = "gear")
r1$print("chart1", include_assets=TRUE)
```
	

---

* MorrisJS:	`mPlot()`
	+ time series graphs: line, bar, area, donut style
	+ [http://morrisjs.github.io/morris.js/]("http://morrisjs.github.io/morris.js/")
	+ [https://github.com/oesmith/morris.js]("https://github.com/oesmith/morris.js")
	+ ![morris.png](./images/morris.png)
	
```{r, echo=FALSE, eval=FALSE, results='asis'}
require(rCharts)

data(economics, package = "ggplot2")
econ <- transform(economics, date = as.character(date))
m2 <- mPlot(x = "date", y = c("psavert", "uempmed"), type = "Line", data = econ)
m2$set(pointSize = 0, lineWidth = 1)
m2$print("chart2", include_assets=TRUE)
```	

---
	
* NVD3:		`nPlot()`
	+ charts that require little customization, based reusable chart components
	+ [http://nvd3.org/]("http://nvd3.org/")
	+ [https://github.com/novus/nvd3]("https://github.com/novus/nvd3")
	+ [http://bost.ocks.org/mike/chart/]("http://bost.ocks.org/mike/chart/")
	+ ![nvd3.png](./images/nvd3.png)
	
	
```{r echo=FALSE, eval=FALSE, results='asis'}
require(rCharts)

hair_eye_male <- subset(as.data.frame(HairEyeColor), Sex == "Male")
n1 <- nPlot(Freq ~ Hair, group = "Eye", data = hair_eye_male, type = "multiBarChart")
n1$print("chart3", include_assets=TRUE)
```

---

* xCharts:	`xPlot()`
	+ includes SVG for infinitely scalable charts
	+ [http://tenxer.github.io/xcharts/]("http://tenxer.github.io/xcharts/")
	+ [https://github.com/tenXer/xcharts/]("https://github.com/tenXer/xcharts/")
	+ ![xcharts.png](./images/xcharts.png)

```{r echo=FALSE, eval=FALSE, results='asis'}
require(rCharts)
require(reshape2)

uspexp <- melt(USPersonalExpenditure)
names(uspexp)[1:2] = c("category", "year")
x1 <- xPlot(value ~ year, group = "category", data = uspexp, type = "line-dotted")
x1$print("chart4", include_assets=TRUE)
```

---
	
* HighCharts:	`hPlot()`
	+ claims to be simples & most flexible, free for non-commercial
	+ related to js libraries _HighStock_ (time series), _HighMaps_ (maps), HighChartsCloud (cloud deployed charts) 
	+ [http://www.highcharts.com/]("http://www.highcharts.com/")
	+ Features: [http://www.highcharts.com/products/highcharts/#open]("http://www.highcharts.com/products/highcharts/#open")
	+ ![highcharts.png](./images/highcharts.png)

```{r echo=FALSE, eval=FALSE, results='asis'}
require(rCharts)

map3 <- Leaflet$new()
map3$setView(c(51.505, -0.09), zoom = 13)
map3$marker(c(51.5, -0.09), bindPopup = "<p> Hi. I am a popup </p>")
map3$marker(c(51.495, -0.083), bindPopup = "<p> Hi. I am another popup </p>")
map3$print("chart7", include_assets=TRUE)
```

---
	
* Leaflet:	`Leaflet$new()`
	+ interactive maps
	+ [http://leafletjs.com/]("http://leafletjs.com/")
	+ Features: [http://leafletjs.com/#features]("http://leafletjs.com/#features")
	+ 36 Plugins: [http://leafletjs.com/plugins.html]("http://leafletjs.com/plugins.html")
	+ ![leaflet.png](./images/leaflet.png)

```{r echo=FALSE, eval=FALSE, results='asis'}
require(rCharts)

```

---
	
* Rickshaw:	`Rickshaw$new()`
	+ time series charts
	+ [https://github.com/shutterstock/rickshaw]("https://github.com/shutterstock/rickshaw")
	+ ![rickshaw.png](./images/rickshaw.png)

```{r echo=FALSE, eval=FALSE, results='asis'}
require(rCharts)

usp = reshape2::melt(USPersonalExpenditure)
# get the decades into a date Rickshaw likes
usp$Var2 <- as.numeric(as.POSIXct(paste0(usp$Var2, "-01-01")))
p4 <- Rickshaw$new()
p4$layer(value ~ Var2, group = "Var1", data = usp, type = "area", width = 560)
# add a helpful slider this easily; other features TRUE as a default
p4$set(slider = TRUE)
p4$print("chart6", include_assets=TRUE)

```

# Publishing rCharts

All static publishing is done with the `rCharts::_Plot::publish()` function.

Dynamic charts are embedded into Shiny by calling  
`rCharts::renderChart(expr = <all code>)` in `server.r`  
and  
`rCharts::showOutput(outputId='<name of chart var: server::output$_____>', lib='js_plotting_lib')` in the `mainPanel()` function of `ui.r`.

```{r eval=FALSE}

r1 <- rPlot(...)
r1$publish(title = 'Title', host = {'rpubs', 'gist', etc.})
```


## RPubs

```{r eval=FALSE}
require(rCharts)

names(iris) = gsub("\\.", "", names(iris))

r1 <- rPlot(SepalLength ~ SepalWidth | Species, data = iris, color = 'Species', type = 'point')

r1$publish('Scatterplot', host = 'rpubs')
```




## Gist

```{r eval=FALSE}
require(rCharts)

names(iris) = gsub("\\.", "", names(iris))

r1 <- rPlot(SepalLength ~ SepalWidth | Species, data = iris, color = 'Species', type = 'point')

r1$publish('Scatterplot', host = 'gist')
```

## Shiny

* must `return(plot_obj)` the plot object inside `renderChart()`
```{r eval=FALSE}
## server.r
require(rCharts)
shinyServer(function(input, output) {
	
  # rCharts::renderChart() takes all the calculation & plotting code
  # and stores the result in the output$myChart; call showOutput('myChart') in ui.r
  output$myChart <- renderChart({
  	
    names(iris) = gsub("\\.", "", names(iris))
    p1 <- rPlot(input$x, input$y, data = iris, color = "Species", 
      facet = "Species", type = 'point')
    p1$addParams(dom = 'myChart')
    return(p1)
  })
})

## ui.R
require(rCharts)
shinyUI(pageWithSidebar(
  headerPanel("rCharts: Interactive Charts from R using polychart.js"),

  sidebarPanel(
    selectInput(inputId = "x",
     label = "Choose X",
     choices = c('SepalLength', 'SepalWidth', 'PetalLength', 'PetalWidth'),
     selected = "SepalLength"),
    selectInput(inputId = "y",
      label = "Choose Y",
      choices = c('SepalLength', 'SepalWidth', 'PetalLength', 'PetalWidth'),
      selected = "SepalWidth")
  ),
  mainPanel(
  	
    # call by the name of server::output#myChart;
    # 'polycharts' is the JS lib that does the plotting	
    showOutput("myChart", "polycharts")
  )
))
```










